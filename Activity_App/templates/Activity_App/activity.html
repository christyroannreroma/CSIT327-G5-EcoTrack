{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard ‚Äî EcoTrack</title>
  
  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <!-- Local Styles -->
  <link rel="stylesheet" href="{% static 'Activity_App/activity.css' %}">
  <link rel="icon" type="image/x-icon" href="{% static 'Homepage_App/images/EcoTrack_Logo1.png' %}">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <script>
    // Expose a small user object for client-side logic (no secrets)
    window.USER = {
      isAuthenticated: {% if user.is_authenticated %}true{% else %}false{% endif %},
      username: {% if user.is_authenticated %}"{{ user.username|escapejs }}"{% else %}null{% endif %}
    };
  </script>
</head>
<body>
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-top">
      <h2 class="sidebar-logo">EcoTrack</h2>
      <nav class="nav-links">
        <a href="{% url 'Dashboard_App:dashboard' %}" class="nav-item">
          <span class="icon">üè†</span> Home
        </a>
        <a href="{% url 'Activity_App:activity' %}" class="nav-item active">
          <span class="icon">‚ûï</span> Add Activity
        </a>
        <a href="{% url 'Challenges_App:challenges' %}" class="nav-item">
          <span class="icon">üèÜ</span> Challenges
        </a>
        <a href="{% url 'History_App:history' %}" class="nav-item">
          <span class="icon">üìú</span> History
        </a>
      </nav>
    </div>

    <div class="sidebar-bottom">
      <a href="#" class="nav-item">
        <span class="icon">‚öôÔ∏è</span> Settings
      </a>
      <a href="#" class="nav-item" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i> Log out
      </a>
    </div>
  </aside>

  <!-- Main Dashboard Content -->
  <div class="dashboard">
    <header>
      <div class="logo">
        <img src="{% static 'Homepage_App/images/EcoTrack_Logo1.png' %}" alt="EcoTrack" style="height: 60px; width: 120px;">
      </div>
      <div class="user-profile" id="userProfile">
        <div class="avatar">
          {% if user.is_authenticated %}
            {% if profile and profile.avatar %}
              <img src="{{ profile.avatar.url }}" alt="Avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;"/>
            {% else %}
              {{ user.username|slice:":2"|upper }}
            {% endif %}
          {% else %}
            Guest
          {% endif %}
        </div>
        <span>
          {% if user.is_authenticated %}
            {{ user.get_full_name|default:user.username }}
          {% else %}
            Guest
          {% endif %}
        </span>
        <i class="fas fa-chevron-down"></i>
        <div class="profile-menu" id="profileMenu">
          <div class="profile-menu-item">
            <a href="{% url 'Profile_App:profile' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-user"></i>
            <span>My Profile</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Activity Selection Columns -->
    <div class="activity-selection" id="activitySelection">
      <h2 class="section-title">Track Your Environmental Impact</h2>
      <p class="section-subtitle">Choose a category to log your activity</p>
      
      <div class="selection-columns">
        <!-- Transportation Column -->
        <div class="selection-column" data-category="transportation">
          <div class="column-content">
            <div class="column-icon">
              <img src="{% static 'Homepage_App/images/Car_Logo.svg' %}" alt="Car Logo" class="icon-svg">
            </div>
            <h3>Transportation</h3>
            <p>Track your travel emissions from cars, buses, trains, and more</p>
            <div class="activity-stats">
              <span class="stat-count">0</span>
              <span class="stat-label">activities this week</span>
            </div>
          </div>
          <button class="select-category-btn">Select Transportation</button>
        </div>
        
        <!-- Diet Column -->
        <div class="selection-column" data-category="diet">
          <div class="column-content">
            <div class="column-icon">
              <img src="{% static 'Homepage_App/images/Meal_Logo.svg' %}" alt="Meal Logo" class="icon-svg">
            </div>
            <h3>Diet</h3>
            <p>Log your meals from meat, dairy, fish, and plant-based options</p>
            <div class="activity-stats">
              <span class="stat-count">0</span>
              <span class="stat-label">meals this week</span>
            </div>
          </div>
          <button class="select-category-btn">Select Diet</button>
        </div>
        
        <!-- Energy Column -->
        <div class="selection-column" data-category="energy">
          <div class="column-content">
            <div class="column-icon">
              <img src="{% static 'Homepage_App/images/Energy_Logo.svg' %}" alt="Energy_Logo" class="icon-svg">
            </div>
            <h3>Energy</h3>
            <p>Monitor your electricity, heating, and renewable energy usage</p>
            <div class="activity-stats">
              <span class="stat-count">0</span>
              <span class="stat-label">activities this week</span>
            </div>
          </div>
          <button class="select-category-btn">Select Energy</button>
        </div>
      </div>
    </div>

    <!-- Activity Forms (Hidden by default) -->
    <div class="activity-forms" style="display: none;">
      <!-- Transportation Form -->
      <div class="activity-form" id="transportation-form">
        <div class="form-header">
          <button class="back-to-selection">
            <i class="fas fa-arrow-left"></i>
            
          </button>
          <div class="form-title">
            <div class="form-icon">
              <img src="{% static 'Homepage_App/images/Car_Logo.svg' %}" alt="Car Logo" class="icon-svg">
            </div>
            <div>
              <h2>Transportation Activity</h2>
              <p>Log your travel and calculate emissions</p>
            </div>
          </div>
        </div>
        
        <div class="form-content">
          <div class="form-card">
            <h3>Travel Details</h3>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="transportType">Transport Type</label>
                <select class="form-select" id="transportType" required>
                  <option value="">Select transport type</option>
                  <option value="car">Car</option>
                  <option value="bus">Bus</option>
                  <option value="train">Train</option>
                  <option value="bicycle">Bicycle</option>
                  <option value="walk">Walking</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="distance">Distance (km)</label>
                <input type="number" class="form-input" id="distance" min="0" step="0.1" placeholder="Enter distance">
                <div class="input-hint">Approximate distance traveled</div>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="transportDate">Date</label>
                <input type="date" class="form-input" id="transportDate">
              </div>
            </div>
            
            <div class="impact-preview">
              <h4>Estimated Environmental Impact</h4>
              <div class="impact-value">0 kg CO2</div>
              <p class="impact-description">Based on your transportation choice and distance</p>
            </div>
            
            <div class="form-actions">
              <button class="cancel-btn">Cancel</button>
              <button class="submit-btn add-activity" data-category="transportation">
                Add Transportation Activity
              </button>
            </div>
          </div>
          
          <div class="form-tips">
            <h4>üí° Transportation Tips</h4>
            <ul>
              <li>Walking and cycling produce zero emissions</li>
              <li>Public transport is more efficient than individual cars</li>
              <li>Carpooling can reduce your carbon footprint by up to 50%</li>
            </ul>
          </div>
        </div>
      </div>
      
      <!-- Diet Form -->
      <div class="activity-form" id="diet-form">
        <div class="form-header">
          <button class="back-to-selection">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="form-title">
            <div class="form-icon">
              <img src="{% static 'Homepage_App/images/Meal_Logo.svg' %}" alt="Meal Logo" class="icon-svg">
            </div>
            <div>
              <h2>Diet Activity</h2>
              <p>Log your meals and their environmental impact</p>
            </div>
          </div>
        </div>
        
        <div class="form-content">
          <div class="form-card">
            <h3>Meal Details</h3>
            <div class="form-group">
              <label class="form-label">Meal Type</label>
              <div class="radio-grid">
                <label class="radio-option large">
                  <input type="radio" name="mealType" value="vegetarian">
                  <div class="radio-content">
                    <div class="radio-icon">ü•¶</div>
                    <div class="radio-text">
                      <div class="radio-title">Vegetarian</div>
                      <div class="radio-description">Plant-based with dairy and eggs</div>
                    </div>
                  </div>
                </label>
                
                <label class="radio-option large">
                  <input type="radio" name="mealType" value="vegan">
                  <div class="radio-content">
                    <div class="radio-icon">üå±</div>
                    <div class="radio-text">
                      <div class="radio-title">Vegan</div>
                      <div class="radio-description">100% plant-based</div>
                    </div>
                  </div>
                </label>
                
                <label class="radio-option large">
                  <input type="radio" name="mealType" value="meat">
                  <div class="radio-content">
                    <div class="radio-icon">üçñ</div>
                    <div class="radio-text">
                      <div class="radio-title">Meat-based</div>
                      <div class="radio-description">Contains meat products</div>
                    </div>
                  </div>
                </label>
                
                <label class="radio-option large">
                  <input type="radio" name="mealType" value="fish">
                  <div class="radio-content">
                    <div class="radio-icon">üêü</div>
                    <div class="radio-text">
                      <div class="radio-title">Fish-based</div>
                      <div class="radio-description">Contains fish or seafood</div>
                    </div>
                  </div>
                </label>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label" for="mealDate">Date</label>
              <input type="date" class="form-input" id="mealDate">
            </div>
            
            <div class="impact-preview">
              <h4>Estimated Environmental Impact</h4>
              <div class="impact-value">0 kg CO2</div>
              <p class="impact-description">Based on your meal choice</p>
            </div>
            
            <div class="form-actions">
              <button class="cancel-btn">Cancel</button>
              <button class="submit-btn add-activity" data-category="diet">
                Add Meal
              </button>
            </div>
          </div>
          
          <div class="form-tips">
            <h4>üí° Diet Tips</h4>
            <ul>
              <li>Plant-based meals have significantly lower carbon footprints</li>
              <li>Local and seasonal produce reduces transportation emissions</li>
              <li>Reducing food waste can cut your dietary emissions by 25%</li>
            </ul>
          </div>
        </div>
      </div>
      
      <!-- Energy Form -->
      <div class="activity-form" id="energy-form">
        <div class="form-header">
          <button class="back-to-selection">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="form-title">
            <div class="form-icon">
              <img src="{% static 'Homepage_App/images/Energy_Logo.svg' %}" alt="Energy_Logo" class="icon-svg">
            </div>
            <div>
              <h2>Energy Activity</h2>
              <p>Track your energy consumption and savings</p>
            </div>
          </div>
        </div>
        
        <div class="form-content">
          <div class="form-card">
            <h3>Energy Usage</h3>
            <div class="form-group">
              <label class="form-label">Energy Type</label>
              <div class="radio-grid">
                <label class="radio-option large">
                  <input type="radio" name="energyType" value="electricity">
                  <div class="radio-content">
                    <div class="radio-icon">üí°</div>
                    <div class="radio-text">
                      <div class="radio-title">Electricity Usage</div>
                      <div class="radio-description">Home or appliance electricity</div>
                    </div>
                  </div>
                </label>
                
                <label class="radio-option large">
                  <input type="radio" name="energyType" value="heating">
                  <div class="radio-content">
                    <div class="radio-icon">üî•</div>
                    <div class="radio-text">
                      <div class="radio-title">Heating</div>
                      <div class="radio-description">Heating system usage</div>
                    </div>
                  </div>
                </label>
                
                <label class="radio-option large">
                  <input type="radio" name="energyType" value="renewable">
                  <div class="radio-content">
                    <div class="radio-icon">‚òÄÔ∏è</div>
                    <div class="radio-text">
                      <div class="radio-title">Renewable Energy</div>
                      <div class="radio-description">Solar, wind, or other renewables</div>
                    </div>
                  </div>
                </label>
              </div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="energyAmount">Amount (kWh)</label>
                <input type="number" class="form-input" id="energyAmount" min="0" step="0.1" placeholder="Enter energy amount">
                <div class="input-hint">Kilowatt-hours consumed or saved</div>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="energyDate">Date</label>
                <input type="date" class="form-input" id="energyDate">
              </div>
            </div>
            
            <div class="impact-preview">
              <h4>Estimated Environmental Impact</h4>
              <div class="impact-value">0 kg CO2</div>
              <p class="impact-description">Based on your energy type and amount</p>
            </div>
            
            <div class="form-actions">
              <button class="cancel-btn">Cancel</button>
              <button class="submit-btn add-activity" data-category="energy">
                Add Energy Activity
              </button>
            </div>
          </div>
          
          <div class="form-tips">
            <h4>üí° Energy Tips</h4>
            <ul>
              <li>LED bulbs use 75% less energy than incandescent bulbs</li>
              <li>Smart thermostats can reduce heating costs by 10-15%</li>
              <li>Unplug electronics when not in use to avoid phantom loads</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Activity added successfully!</span>
  </div>

  <!-- Logout Confirmation Modal -->
  <div class="modal" id="logoutModal" style="display: none;">
    <div class="modal-content logout-modal">
      <div class="logout-icon">
        <i class="fas fa-sign-out-alt"></i>
      </div>
      <h3>Ready to leave?</h3>
      <p>You'll need to sign in again to access your dashboard.</p>
      <div class="logout-actions">
        <button class="btn-logout-cancel">Stay Signed In</button>
        <a href="{% url 'Login_App:logout' %}" class="btn-logout-confirm">
          <i class="fas fa-sign-out-alt"></i>
          Yes, Log Out
        </a>
      </div>
    </div>
  </div>
  
  <!-- JavaScript -->
  <script src="{% static 'Activity_App/activity.js' %}"></script>
  <script>
    (function() {
      // Bind logout modal handlers once for the Activity page
      var logoutLinks = Array.from(document.querySelectorAll('a[href*="logout"]'));
      var modal = document.getElementById('logoutModal');

      if (!modal) {
        logoutLinks.forEach(function(a){
          if (a.classList && a.classList.contains('btn-logout-confirm')) return;
          a.addEventListener('click', function(e){ e.preventDefault(); window.location = a.getAttribute('href'); });
        });
        return;
      }

      var cancelBtn = modal.querySelector('.btn-logout-cancel');
      var confirmBtn = modal.querySelector('.btn-logout-confirm');

      function openModalFor(href) {
        if (confirmBtn && href) confirmBtn.setAttribute('href', href);
        modal.style.display = 'flex';
      }

      function closeModal() { modal.style.display = 'none'; }

      if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', function(ev){ if (ev.target === modal) closeModal(); });
      window.addEventListener('keydown', function(ev){ if (ev.key === 'Escape') closeModal(); });

      logoutLinks.forEach(function(a){
        if (a.classList && a.classList.contains('btn-logout-confirm')) return;
        a.addEventListener('click', function(e){ e.preventDefault(); openModalFor(a.getAttribute('href')); });
      });
    })();
  </script>
</body>
</html>